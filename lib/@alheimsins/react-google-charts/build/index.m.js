import{Component as o,createElement as t}from"react";var e=["#3366CC","#DC3912","#FF9900","#109618","#990099","#3B3EAC","#0099C6","#DD4477","#66AA00","#B82E2E","#316395","#994499","#22AA99","#AAAA11","#6633CC","#E67300","#8B0707","#329262","#5574A6","#3B3EAC"],r=Object.freeze({DEFAULT_CHART_COLORS:e,default:e}),a=function(o){if(void 0===o&&(o=window),void 0===o)return{};if(void 0===o.google)throw new Error("google not in window object. Error in get-google-charts.");return o.google},n=new function(){var o=this;this.isLoaded=!1,this.isLoading=!1,this.loadScript=null,this.destroy=function(){o.isLoading=!1,o.isLoaded=!1,o.loadScript=null},this.init=function(t,e,r,a){if((o.isLoading||o.isLoaded)&&null!==o.loadScript)return o.loadScript;o.isLoading=!0;var n="undefined"!=typeof window?require("loadjs"):function(o,t){return(0,t.success)()};return o.loadScript=new Promise(function(i){n("https://www.gstatic.com/charts/loader.js",{success:function(){var n=function(o){if(void 0===o&&(o=window),void 0===o)return{};if(void 0===o.google)throw new Error("google not in window object. Error in get-google-charts.");return o.google.charts}(window);n.load(e||"current",{packages:t||["corechart"],language:r||"en",mapsApiKey:a}),n.setOnLoadCallback(function(){o.isLoaded=!0,o.isLoading=!1,i()})}})}),o.isLoading=!0,o.loadScript}},i=0,s=function(){return"reactgooglegraph-"+(i+=1)},l=function(o){function i(t){var n=this;o.call(this,t),this.chart=null,this.wrapper=null,this.hidden_columns={},this.dataTable=[],this.isUnmounted=!1,this.onResize=function(){n.drawChart()},this.onSelectToggle=function(){if(null!==n.chart&&n.props.legend_toggle){var o=n.chart.getSelection();if(o.length>0)if(null==o[0].row)n.togglePoints(o[0].column)}},this.getColumnColor=function(o){if(n.props.options&&n.props.options.colors){if(n.props.options.colors[o])return n.props.options.colors[o]}else if(o in r)return r[o];return r[0]},this.applyNumberFormat=function(o,t){new(a(window).visualization.NumberFormat)(t).format(n.dataTable,o)},this.applyDateFormat=function(o,t){new(a(window).visualization.DateFormat)(t).format(n.dataTable,o)},this.buildDataTableFromProps=function(){var o=n.props.chartType,t=a(window);if(n.props.diffdata&&null!==n.props.chartType){var e=n.props.diffdata,r=t.visualization.arrayToDataTable(e.old),i=t.visualization.arrayToDataTable(e.new);return(0,t.visualization[o].prototype.computeDiff)(r,i)}if(null===n.props.data&&n.props.rows&&0===n.props.rows.length&&!1==!n.props.allowEmptyRows)throw new Error("Can't build DataTable from rows and columns: rows array in props is empty");if(null===n.props.data&&n.props.columns&&0===n.props.columns.length)throw new Error("Can't build DataTable from rows and columns: columns array in props is empty");if(null!==n.props.data)try{return n.wrapper.setDataTable(n.props.data),n.wrapper.getDataTable()}catch(o){throw new Error("Failed to set DataTable from data props ! ",o)}var s=new window.google.visualization.DataTable;if(n.props.columns.forEach(function(o){s.addColumn(o)}),s.addRows(n.props.rows),n.props.numberFormat){var l=n.props.numberFormat;n.applyNumberFormat(l.column,l.options)}if(n.props.dateFormat){var p=n.props.dateFormat,d=p.options;p.columns.forEach(function(o){n.applyDateFormat(o,d)})}return n.props.formatters.forEach(function(o){var t=o.type,e=o.column,r=o.options;switch(t){case"NumberFormat":n.applyNumberFormat(e,r);break;case"DateFormat":n.applyDateFormat(e,r);break;default:console.log("Unkown formatter type: "+t)}}),s},this.updateDataTable=function(){return window.google.visualization.errors.removeAll(document.getElementById(n.wrapper.getContainerId())),n.dataTable.removeRows(0,n.dataTable.getNumberOfRows()),n.dataTable.removeColumns(0,n.dataTable.getNumberOfColumns()),n.dataTable=n.buildDataTableFromProps(),n.dataTable},this.drawChart=function(){if(!n.isUnmounted){if(n.wrapper){if(n.updateDataTable(),n.wrapper.setDataTable(n.dataTable),n.wrapper.setOptions(n.props.options),n.wrapper.getChartType()!==n.props.chartType){window.google.visualization.events.removeAllListeners(n.wrapper),n.wrapper.setChartType(n.props.chartType);var o=n;window.google.visualization.events.addOneTimeListener(n.wrapper,"ready",function(){o.chart=o.wrapper.getChart(),o.listenToChartEvents.call(o)})}}else n.wrapper=new window.google.visualization.ChartWrapper({chartType:n.props.chartType,options:n.props.options,containerId:n.state.graphID}),n.dataTable=n.buildDataTableFromProps(),n.wrapper.setDataTable(n.dataTable),window.google.visualization.events.addOneTimeListener(n.wrapper,"ready",function(){n.chart=n.wrapper.getChart(),n.listenToChartEvents(),n.addChartActions()});n.wrapper.draw()}},this.addChartActions=function(){null!==n.props.chartActions&&n.props.chartActions.forEach(function(o){n.chart.setAction({id:o.id,text:o.text,action:o.action.bind(n,n.chart)})})},this.listenToChartEvents=function(){n.props.legend_toggle&&window.google.visualization.events.addListener(n.wrapper,"select",n.onSelectToggle),n.props.chartEvents.forEach(function(o){var t;"ready"===o.eventName?o.callback(n):(t=o,window.google.visualization.events.addListener(n.chart,t.eventName,function(o){t.callback(n,o)}))})},this.buildColumnFromSourceData=function(o){return{label:n.dataTable.getColumnLabel(o),type:n.dataTable.getColumnType(o),sourceColumn:o,role:n.dataTable.getColumnRole(o)}},this.buildEmptyColumnFromSourceData=function(o){return{label:n.dataTable.getColumnLabel(o),type:n.dataTable.getColumnType(o),calc:function(){return null},role:n.dataTable.getColumnRole(o)}},this.addEmptyColumnTo=function(o,t){var e=n.buildEmptyColumnFromSourceData(t);o.push(e)},this.hideColumn=function(o,t){n.isHidden(t)||(n.hidden_columns[t]={color:n.getColumnColor(t-1)}),o.push("#CCCCCC")},this.addSourceColumnTo=function(o,t){var e=n.buildColumnFromSourceData(t);o.push(e)},this.isHidden=function(o){return void 0!==n.hidden_columns[o]},this.restoreColorTo=function(o,t){var e;n.isHidden(t)?(e=n.hidden_columns[t].color,delete n.hidden_columns[t]):e=n.getColumnColor(t-1),0!==t&&o.push(e)},this.debounce=function(o,t){var e;return function(){for(var r=[],a=arguments.length;a--;)r[a]=arguments[a];var n=this;clearTimeout(e),e=setTimeout(function(){return o.apply(n,r)},t)}},this.togglePoints=function(o){for(var t=new window.google.visualization.DataView(n.wrapper.getDataTable()),r=t.getNumberOfColumns(),a=n.props.options&&n.props.options.colors?n.props.options.colors:e,i=[],s=0;s<r;s+=1)0===s?n.addSourceColumnTo(i,s):s===o?n.isHidden(s)?(n.addSourceColumnTo(i,s),n.restoreColorTo(a,s)):(n.addEmptyColumnTo(i,s),n.hideColumn(a,s)):n.isHidden(s)?(n.addEmptyColumnTo(i,s),n.hideColumn(a,s)):(n.addSourceColumnTo(i,s),n.restoreColorTo(a,s));t.setColumns(i),n.props.options.colors=a,n.chart.draw(t,n.props.options)},this.state={graphID:t.graph_id||s()}}return o&&(i.__proto__=o),(i.prototype=Object.create(o&&o.prototype)).constructor=i,i.prototype.componentDidMount=function(){var o=this;"undefined"!=typeof window&&(this.props.loadCharts?n.init(this.props.chartPackages,this.props.chartVersion,this.props.chartLanguage,this.props.mapsApiKey).then(function(){o.drawChart(),o.onResize=o.debounce(o.onResize,200),window.addEventListener("resize",o.onResize)}):this.drawChart())},i.prototype.componentDidUpdate=function(){var o=this;this.props.loadCharts?n.isLoading?n.loadScript&&n.loadScript.then(function(){o.drawChart()}):n.isLoaded&&this.drawChart():this.drawChart()},i.prototype.componentWillUnmount=function(){this.isUnmounted=!0,n.destroy();try{window&&(window.google&&window.google.visualization&&window.google.visualization.events.removeAllListeners(this.wrapper),window.removeEventListener("resize",this.onResize))}catch(o){return}},i.prototype.render=function(){return t("div",{id:this.state.graphID,style:{height:this.props.height||this.props.options.height,width:this.props.width||this.props.options.width}},this.props.loader?this.props.loader:"Rendering Chart...")},i}(o);l.defaultProps={chartType:"LineChart",rows:[],columns:[],options:{chart:{title:"Chart Title",subtitle:"Subtitle"},hAxis:{title:"X Label"},vAxis:{title:"Y Label"},width:"100%",height:"100%"},width:"400px",height:"300px",chartEvents:[],chartActions:null,data:null,legend_toggle:!1,allowEmptyRows:!1,loadCharts:!0,loader:t("div",null,"Rendering Chart"),chartPackages:["corechart"],chartVersion:"current",chartLanguage:"en",numberFormat:null,dateFormat:null,formatters:[],diffdata:null};export default{Chart:l};export{l as Chart};
//# sourceMappingURL=index.m.js.map
